<?xml version="1.0"?>
<antlib>

  <macrodef name="schemacrawler-velocity">

    <!-- Attributes -->
    <attribute
      name="config"
      default="schemacrawler.config.properties" />
    <attribute
      name="config-override"
      default="schemacrawler.config.override.properties" />

    <attribute name="datasource" />
    <attribute
      name="db-driver-classpath"
      default="${db-driver-classpath}" />

    <attribute
      name="velocity-classpath"
      default="${velocity-classpath}" />

    <attribute name="command" />

    <attribute name="template" />
    <attribute name="outputfile" />

    <attribute
      name="loglevel"
      description="Log level - may be one of: OFF, SEVERE, WARNING, INFO, CONFIG, FINE, FINER, FINEST, ALL"
      default="SEVERE" />

    <sequential>

      <!-- Required properties: -->
      <property
        name="schemacrawler.dir"
        value="${basedir}" />

      <java
        taskname="schemacrawler-velocity"
        classname="schemacrawler.tools.integration.velocity.Main"
        logerror="true"
        failonerror="true">
        <classpath>
          <fileset dir="${schemacrawler.dir}">
            <include name="*.jar" />
          </fileset>
          <path refid="@{db-driver-classpath}" />
          <path refid="@{velocity-classpath}" />
        </classpath>
        <arg value="-g" />
        <arg value="@{config}" />
        <arg value="-p" />
        <arg value="@{config-override}" />
        <arg value="-c" />
        <arg value="@{datasource}" />
        <arg value="-command" />
        <arg value="@{command}" />
        <arg value="-outputformat" />
        <arg value="@{template}" />
        <arg value="-outputfile" />
        <arg value="@{outputfile}" />
        <arg value="-loglevel=@{loglevel}" />
      </java>
    </sequential>

  </macrodef>

  <macrodef name="schemacrawler-graphing">

    <!-- Attributes -->
    <attribute
      name="config"
      default="schemacrawler.config.properties" />
    <attribute
      name="config-override"
      default="schemacrawler.config.override.properties" />

    <attribute name="datasource" />
    <attribute
      name="db-driver-classpath"
      default="${db-driver-classpath}" />

    <attribute name="command" />

    <attribute name="graph-type" />
    <attribute name="outputfile" />

    <attribute
      name="loglevel"
      description="Log level - may be one of: OFF, SEVERE, WARNING, INFO, CONFIG, FINE, FINER, FINEST, ALL"
      default="SEVERE" />

    <sequential>

      <!-- Required properties: -->
      <property
        name="schemacrawler.dir"
        value="${basedir}" />

      <java
        taskname="schemacrawler-diagram"
        classname="schemacrawler.tools.integration.graph.Main"
        logerror="true"
        failonerror="true">
        <classpath>
          <fileset dir="${schemacrawler.dir}">
            <include name="*.jar" />
          </fileset>
          <path refid="@{db-driver-classpath}" />
        </classpath>
        <arg value="-g" />
        <arg value="@{config}" />
        <arg value="-p" />
        <arg value="@{config-override}" />
        <arg value="-c" />
        <arg value="@{datasource}" />
        <arg value="-command" />
        <arg value="@{command}" />
        <arg value="-outputformat" />
        <arg value="@{graph-type}" />
        <arg value="-outputfile" />
        <arg value="@{outputfile}" />
        <arg value="-loglevel=@{loglevel}" />
      </java>
    </sequential>

  </macrodef>

  <macrodef name="schemacrawler-diagram">

    <!-- Attributes -->
    <attribute
      name="config"
      default="schemacrawler.config.properties" />
    <attribute
      name="config-override"
      default="schemacrawler.config.override.properties" />

    <attribute name="datasource" />
    <attribute
      name="db-driver-classpath"
      default="${db-driver-classpath}" />

    <attribute name="command" />

    <attribute name="graph-type" />
    <attribute name="outputfile" />

    <attribute
      name="loglevel"
      description="Log level - may be one of: OFF, SEVERE, WARNING, INFO, CONFIG, FINE, FINER, FINEST, ALL"
      default="SEVERE" />

    <sequential>

      <!-- Required properties: -->
      <property
        name="schemacrawler.dir"
        value="${basedir}" />

      <java
        taskname="schemacrawler-diagram"
        classname="schemacrawler.tools.integration.graph.Main"
        logerror="true"
        failonerror="true">
        <classpath>
          <fileset dir="${schemacrawler.dir}">
            <include name="*.jar" />
          </fileset>
          <path refid="@{db-driver-classpath}" />
        </classpath>
        <arg value="-g" />
        <arg value="@{config}" />
        <arg value="-p" />
        <arg value="@{config-override}" />
        <arg value="-c" />
        <arg value="@{datasource}" />
        <arg value="-command" />
        <arg value="@{command}" />
        <arg value="-outputformat" />
        <arg value="@{graph-type}" />
        <arg value="-outputfile" />
        <arg value="@{outputfile}" />
        <arg value="-loglevel=@{loglevel}" />
      </java>
    </sequential>

  </macrodef>
  
  <macrodef name="schemacrawler-spring">

    <!-- Attributes -->
    <attribute
      name="context-file"
      default="schemacrawler.context.xml" />
    <attribute
      name="executable"
      default="executable" />
    <attribute
      name="datasource"
      default="datasource" />

    <attribute
      name="db-driver-classpath"
      default="${db-driver-classpath}" />

    <attribute
      name="spring-classpath"
      default="${spring-classpath}" />
      
    <attribute
      name="loglevel"
      description="Log level - may be one of: OFF, SEVERE, WARNING, INFO, CONFIG, FINE, FINER, FINEST, ALL"
      default="SEVERE" />

    <sequential>

      <!-- Required properties: -->
      <property
        name="schemacrawler.dir"
        value="${basedir}" />

      <java
        taskname="schemacrawler-spring"
        classname="schemacrawler.tools.integration.spring.Main"
        logerror="true"
        failonerror="true">
        <classpath>
          <fileset dir="${schemacrawler.dir}">
            <include name="*.jar" />
          </fileset>
          <path refid="@{db-driver-classpath}" />
          <path refid="@{spring-classpath}" />
        </classpath>
        <arg value="-context-file" />
        <arg value="@{context-file}" />
        <arg value="-executable" />
        <arg value="@{executable}" />
        <arg value="-datasource" />
        <arg value="@{datasource}" />        
        <arg value="-loglevel=@{loglevel}" />
      </java>
    </sequential>

  </macrodef>

</antlib>
